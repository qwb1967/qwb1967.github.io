webpackJsonp([14],{"+f0B":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("IHPB"),d=a.n(o),n=a("vQ9I"),l={data:function(){return{dialogTitle:"新增待办",dialogFormVisible:!1,addTodoForm:{},formLabelWidth:"200px",monthVal:new Date,form:{ownerId:0,name:"",petId:0,petName:""},searchType:[],editDialogTitle:"编辑待办",editDialogFormVisible:!1,tableData:[],cellWidth:"",dt:"",rules:{date:[{required:!0,message:"请选择事件日期",trigger:"blur"}]}}},mounted:function(){this.getPrimaryBusiness(),this.build()},methods:{build:function(){var e=this;this.$nextTick(function(){e.cleanShow(),Object(n.a)({url:"/api/todo/list",method:"get",params:{dt:e.monthVal},success:function(e){for(var t=e.data.data.list,a=0;a<t.length;a++){var o=document.querySelector("#p"+t[a].date);o.append(document.createElement("br")),o.className="div-p";var d=document.createElement("span");d.append(t[a].time+" "+t[a].typeDesc),null!=t[a].ownerName&&d.append(" "+t[a].ownerName),null!=t[a].petName&&d.append(" "+t[a].petName),null!=t[a].title&&d.append(" "+t[a].title),2===t[a].status&&(d.style.color="green");var n=document.createElement("i");null!=t[a].remindDate&&(n.className="el-icon-chat-dot-square",t[a].smsRemind>0&&(n.style.color="green")),o.appendChild(d),o.appendChild(n)}},fail:function(e){console.log(e)}},e)})},buildday:function(e){Object(n.a)({url:"/api/todo/listOfDay",method:"get",params:{dt:e},success:function(t){var a=document.querySelector("#p"+e);a.innerHTML="",a.className="div-p";for(var o=0;o<t.data.data.length;o++){a.append(document.createElement("br"));var d=document.createElement("span");d.append(t.data.data[o].time+" "+t.data.data[o].typeDesc),null!=t.data.data[o].ownerName&&d.append(" "+t.data.data[o].ownerName),null!=t.data.data[o].petName&&d.append(" "+t.data.data[o].petName),null!=t.data.data[o].title&&d.append(" "+t.data.data[o].title),2===t.data.data[o].status&&(d.style.color="green");var n=document.createElement("i");null!=t.data.data[o].remindDate&&(n.className="el-icon-chat-dot-square",t.data.data[o].smsRemind>0&&(n.style.color="green")),a.appendChild(d),a.appendChild(n)}},fail:function(e){console.log(e)}},this)},cleanShow:function(){var e=this;this.$nextTick(function(){for(var t=e.formatDate(e.monthVal,"yyyy-MM-"),a=0,o=0;o<31;o++){(a=o+1)<10&&(a="0"+a);var d=document.querySelector("#p"+t+a);null!=d&&(d.innerHTML="")}for(t=e.formatDate(e.addMonth(e.monthVal,-1),"yyyy-MM-"),a=0,o=0;o<31;o++)(a=o+1)<10&&(a="0"+a),null!=(d=document.querySelector("#p"+t+a))&&(d.innerHTML="");for(t=e.formatDate(e.addMonth(e.monthVal,1),"yyyy-MM-"),a=0,o=0;o<31;o++)(a=o+1)<10&&(a="0"+a),null!=(d=document.querySelector("#p"+t+a))&&(d.innerHTML="")})},dateChange:function(){this.addTodoForm.isremind&&(this.addTodoForm.remindDate=this.addTodoForm.date)},addTodo:function(e){this.addTodoForm={time:"10:00",type:4,date:new Date(e),remindDate:null,remindTime:null,isremind:!1,ownerId:null},this.form={},this.dialogFormVisible=!0},addTodoSave:function(e){var t=this;this.addTodoForm.isremind&&null==this.addTodoForm.ownerId?this.$message({message:"如需短信提醒，请选择会员",center:!0,type:"info"}):this.addTodoForm.isremind&&null==this.addTodoForm.remindDate?this.$message({message:"如需短信提醒，请选择提醒日期",center:!0,type:"info"}):this.$refs.addTodoForm.validate(function(a){a&&Object(n.a)({url:"/api/todo/addTodoList",method:"post",data:t.addTodoForm,success:function(a){t.$message({message:"添加成功",center:!0,type:"success"}),t.buildday(t.formatDate(t.addTodoForm.date,"yyyy-MM-dd")),1===e?t.dialogFormVisible=!1:t.addTodoForm.date=null},fail:function(e){console.log(e)}},t)})},remind:function(){this.addTodoForm.isremind?(this.addTodoForm.remindDate=this.addTodoForm.date,this.addTodoForm.remindTime="10:00"):(this.addTodoForm.remindDate=null,this.addTodoForm.remindTime=null)},editTodo:function(e){var t=this;Object(n.a)({url:"/api/todo/listOfDay",method:"get",params:{dt:e},success:function(e){t.tableData=e.data.data},fail:function(e){console.log(e)}},this),this.dt=e,this.editDialogFormVisible=!0},todoDel:function(e){var t=this;this.$confirm("删除待办事项, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){Object(n.a)({url:"/api/todo/del",method:"get",params:{id:e},success:function(e){t.editTodo(t.dt),t.buildday(t.dt),t.$message({message:"已删除",center:!0,type:"success"})},fail:function(e){console.log(e)}},t)})},querySearchAsync:function(e,t){Object(n.a)({url:"/api/owner/getUserOwnerDtoList",method:"get",params:{str:e},success:function(e){var a=e.data.data;t(a)},fail:function(e){console.log(e)}},this)},handleSelect:function(e){var t=this;Object(n.a)({url:"/api/owner/getUserOwnerHomePageInfo",method:"get",params:{id:e.id},success:function(a){200===a.data.code?(t.form=a.data.data,t.addTodoForm.ownerName=e.name,t.addTodoForm.ownerId=e.id):t.$message({message:"查询会员信息失败",center:!0,type:"error"})},fail:function(e){console.log(e)}},this)},petSelect:function(e){this.addTodoForm.petId=this.form.petHomePageInfos[e].id,this.addTodoForm.petName=this.form.petHomePageInfos[e].name},getPrimaryBusiness:function(){var e=this;Object(n.a)({url:"/api/store/getPrimaryBusiness",method:"get",success:function(t){var a;e.category=t.data.data,(a=e.searchType).push.apply(a,d()(t.data.data))},fail:function(e){console.log(e)}},this)},formatDate:function(e,t){/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var o in a)if(new RegExp("("+o+")").test(t)){var d=a[o]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?d:this.padLeftZero(d))}return t},addMonth:function(e,t){t=parseInt(t);var a=e,o=a.getFullYear(),d=a.getMonth()+1+t,n=a.getDate();for(0===d&&(o+=1,d=1);d>12;)o++,d-=12;for(var l=new Date(o,d-1,n);l.getMonth()!==d-1;)n--,l=new Date(o,d-1,n);return l},padLeftZero:function(e){return("00"+e).substr(e.length)}},watch:{monthVal:function(e,t){this.formatDate(e,"yyyy-MM")!==this.formatDate(t,"yyyy-MM")&&this.build()}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("el-calendar",{scopedSlots:e._u([{key:"dateCell",fn:function(t){t.date;var o=t.data;return[e._v("\n      "+e._s(o.day.substring(8,10))+" "),a("span",{staticClass:"el-icon-circle-plus-outline addtodoicon",on:{click:function(t){return e.addTodo(o.day)}}}),e._v(" "),a("el-popover",{attrs:{placement:"top-start",width:90,trigger:"hover"}},[a("el-button",{staticClass:"popover_button",attrs:{size:"mini",type:"text"},on:{click:function(t){return e.editTodo(o.day)}}},[e._v("查看全部")]),e._v(" "),a("span",{attrs:{slot:"reference",id:"p"+o.day},slot:"reference"})],1)]}}]),model:{value:e.monthVal,callback:function(t){e.monthVal=t},expression:"monthVal"}}),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,width:"670px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"addTodoForm",attrs:{model:e.addTodoForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"日期:","label-width":e.formLabelWidth,prop:"date"}},[a("span",{staticClass:"right_input"},[a("el-date-picker",{staticStyle:{width:"300px"},attrs:{size:"medium",type:"date",placeholder:"事件日期"},on:{change:e.dateChange},model:{value:e.addTodoForm.date,callback:function(t){e.$set(e.addTodoForm,"date",t)},expression:"addTodoForm.date"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"标题:","label-width":e.formLabelWidth}},[a("span",{staticClass:"right_input"},[a("el-input",{attrs:{size:"medium",placeholder:"输入标题",maxlength:"10","show-word-limit":""},model:{value:e.addTodoForm.title,callback:function(t){e.$set(e.addTodoForm,"title",t)},expression:"addTodoForm.title"}},[a("el-select",{staticClass:"select-left",attrs:{slot:"prepend",size:"medium",placeholder:"请选择"},slot:"prepend",model:{value:e.addTodoForm.type,callback:function(t){e.$set(e.addTodoForm,"type",t)},expression:"addTodoForm.type"}},e._l(e.searchType,function(e){return a("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}),1)],1)],1)]),e._v(" "),a("el-form-item",{attrs:{label:"内容:","label-width":e.formLabelWidth}},[a("span",{staticClass:"right_input"},[a("el-input",{attrs:{size:"medium",type:"textarea",maxlength:"225","show-word-limit":"","auto-complete":"off"},model:{value:e.addTodoForm.content,callback:function(t){e.$set(e.addTodoForm,"content",t)},expression:"addTodoForm.content"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"选择会员:","label-width":e.formLabelWidth}},[a("span",{staticClass:"right_input"},[a("el-autocomplete",{attrs:{size:"medium","fetch-suggestions":e.querySearchAsync,placeholder:"会员名称、手机号、宠物名称","trigger-on-focus":!1},on:{select:e.handleSelect},model:{value:e.addTodoForm.ownerName,callback:function(t){e.$set(e.addTodoForm,"ownerName",t)},expression:"addTodoForm.ownerName"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"选择宠物:","label-width":e.formLabelWidth}},[a("span",{staticClass:"right_input"},[a("el-select",{attrs:{size:"medium",filterable:"",placeholder:"选择宠物"},on:{change:e.petSelect},model:{value:e.addTodoForm.petName,callback:function(t){e.$set(e.addTodoForm,"petName",t)},expression:"addTodoForm.petName"}},e._l(e.form.petHomePageInfos,function(e,t){return a("el-option",{key:e.id,attrs:{label:e.name,value:t}})}),1)],1)]),e._v(" "),a("el-form-item",{attrs:{label:"服务时间:","label-width":e.formLabelWidth}},[a("span",{staticClass:"right_input"},[a("el-time-select",{staticStyle:{width:"300px"},attrs:{size:"medium","picker-options":{start:"07:00",step:"00:30",end:"20:00"},placeholder:"服务时间"},model:{value:e.addTodoForm.time,callback:function(t){e.$set(e.addTodoForm,"time",t)},expression:"addTodoForm.time"}})],1)]),e._v(" "),a("el-form-item",{attrs:{label:"短信提醒:","label-width":e.formLabelWidth}},[a("span",{staticClass:"right_input"},[a("el-checkbox",{attrs:{size:"medium"},on:{change:e.remind},model:{value:e.addTodoForm.isremind,callback:function(t){e.$set(e.addTodoForm,"isremind",t)},expression:"addTodoForm.isremind"}},[e._v("勾选提醒会员")])],1)]),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.addTodoForm.isremind,expression:"addTodoForm.isremind"}],attrs:{label:"提醒时间:","label-width":e.formLabelWidth}},[a("span",{staticClass:"right_input"},[a("el-date-picker",{staticStyle:{float:"left",width:"170px"},attrs:{size:"medium",type:"date",placeholder:"提醒日期"},model:{value:e.addTodoForm.remindDate,callback:function(t){e.$set(e.addTodoForm,"remindDate",t)},expression:"addTodoForm.remindDate"}}),e._v(" "),a("el-time-select",{staticStyle:{float:"left",width:"130px"},attrs:{size:"medium","picker-options":{start:"07:00",step:"00:30",end:"20:00"},placeholder:"提醒时间"},model:{value:e.addTodoForm.remindTime,callback:function(t){e.$set(e.addTodoForm,"remindTime",t)},expression:"addTodoForm.remindTime"}})],1)])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"medium",round:""},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"medium",type:"primary",round:""},on:{click:function(t){return e.addTodoSave(1)}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"medium",type:"primary",round:""},on:{click:function(t){return e.addTodoSave(2)}}},[e._v("保存并添加下一个")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.editDialogTitle,visible:e.editDialogFormVisible,width:"1240px"},on:{"update:visible":function(t){e.editDialogFormVisible=t}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"时间",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.time))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"服务",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.typeDesc)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"标题",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.title)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"内容",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.content)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"短信提醒时间",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.remindDate)+"\n          "),0==t.row.smsRemind&&null!=t.row.remindDate?a("i",{staticClass:"el-icon-chat-dot-square"}):e._e(),e._v(" "),t.row.smsRemind>0&&null!=t.row.remindDate?a("i",{staticClass:"el-icon-chat-dot-square",staticStyle:{color:"green"}}):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"会员",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.ownerName)+"\n          "),null!=t.row.phone?a("el-tooltip",{attrs:{effect:"dark",content:t.row.phone,placement:"top"}},[a("i",{staticClass:"el-icon-mobile"})]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"宠物",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.petName)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:e.cellWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",round:""},on:{click:function(a){return e.todoDel(t.row.id)}}},[e._v("删除")])]}}])})],1)],1)],1)},staticRenderFns:[]};var r=a("C7Lr")(l,i,!1,function(e){a("cJh9")},"data-v-27694c06",null);t.default=r.exports},cJh9:function(e,t){}});